{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}Doctor Dashboard ¬∑ MediCare{% endblock %}

{% block nav_tabs %}
  <button class="nav-tab active" onclick="switchTab('queue', this)">
    Today's Queue <span class="tab-count">{{ today_queue|length }}</span>
  </button>
  <button class="nav-tab" onclick="switchTab('completed', this)">
    Completed <span class="tab-count">{{ compiled_appointments|length }}</span>
  </button>
{% endblock %}

{% block content %}

  <!-- ‚îÄ‚îÄ Page header ‚îÄ‚îÄ -->
  <div class="pg-header">
    <h1>Welcome, <em>Dr. {{ user.get_full_name }}</em> üë®‚Äç‚öïÔ∏è</h1>
    <p>
      {{ user.doctor_profile.specialization }} &nbsp;¬∑&nbsp;
      {% now "l, d M Y" %} &nbsp;¬∑&nbsp;
      Session: {{ user.doctor_profile.session_duration }} min
    </p>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TAB 1 ¬∑ TODAY'S QUEUE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="tab-queue" class="tab-panel active">
    <section>
      <div class="sec-head">
        Today's Queue
        <span>Ordered by appointment time</span>
      </div>

      {% if today_queue %}
        {% for appt in today_queue %}
          {% include "dashboard/appt_card.html" with appt=appt show_queue=True loop_counter=forloop.counter %}
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg>
          <p>No patients existed now.</p>
        </div>
      {% endif %}
    </section>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TAB 2 ¬∑ COMPLETED
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="tab-completed" class="tab-panel">
    <section>
      <div class="sec-head">
        Completed Today
        <span>
          {{ compiled_appointments|length }}
          session{% if compiled_appointments|length != 1 %}s{% endif %} done
        </span>
      </div>

      {% if compiled_appointments %}
        {% for appt in compiled_appointments %}
          {% include "dashboard/appt_card.html" with appt=appt %}
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18z"/></svg>
          <p>No completed appointments yet today.</p>
        </div>
      {% endif %}
    </section>
  </div>

{% endblock %}

{% block extra_scripts %}
<script>
  // Wire up No Show modal open helper (used inside appt_card partial)
  function openNoShow(apptId, patientName) {
    document.getElementById('noshow-name').textContent = patientName;
    document.getElementById('noShowForm').action = '/appointments/' + apptId + '/no-show/';
    document.getElementById('noShowModal').classList.add('open');
  }
</script>
{% endblock %}