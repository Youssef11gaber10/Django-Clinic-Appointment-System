<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:          #f5f3ef;
      --surface:     #ffffff;
      --sidebar-bg:  #1a1a2e;
      --sidebar-hover: #ffffff12;
      --sidebar-act: #ffffff1f;
      --accent:      #c8a97e;
      --accent2:     #6a9fb5;
      --text:        #1c1c1c;
      --muted:       #7a7a7a;
      --border:      #e5e2da;
      --success:     #6abf8a;
      --danger:      #e07070;
      --radius:      14px;
      --shadow:      0 4px 24px rgba(0,0,0,.07);
      --nav-h:       64px;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex; flex-direction: column;
      font-size: 15px; line-height: 1.55;
    }

    /* â”€â”€ TOP NAV â”€â”€ */
    .topnav {
      position: sticky; top: 0; z-index: 100;
      height: var(--nav-h);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem;
      box-shadow: 0 1px 8px rgba(0,0,0,.04);
    }
    .brand { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--text); }
    .brand-icon {
      width: 36px; height: 36px; border-radius: 10px;
      background: var(--sidebar-bg);
      display: flex; align-items: center; justify-content: center;
    }
    .brand-icon svg { width: 18px; height: 18px; fill: var(--accent); }
    .brand-name { font-family: 'DM Serif Display', serif; font-size: 1.2rem; }
    .nav-right { display: flex; align-items: center; gap: 1rem; }
    .nav-avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; font-size: .82rem; color: #fff;
    }
    .logout {
      font-size: .83rem; color: var(--muted); text-decoration: none;
      padding: 6px 14px; border: 1px solid var(--border); border-radius: 8px;
      transition: all .18s;
    }
    .logout:hover { background: var(--bg); color: var(--text); }

    /* â”€â”€ SHELL â”€â”€ */
    .shell { display: flex; flex: 1; }

    /* â”€â”€ SIDEBAR â”€â”€ */
    .sidebar {
      width: 228px; flex-shrink: 0;
      background: var(--sidebar-bg);
      padding: 1.6rem .9rem;
      display: flex; flex-direction: column; gap: .2rem;
      position: sticky; top: var(--nav-h);
      height: calc(100vh - var(--nav-h));
      overflow-y: auto;
    }
    .sec-label {
      font-size: .68rem; font-weight: 600; letter-spacing: .13em;
      text-transform: uppercase; color: #ffffff38;
      padding: .6rem .8rem .2rem; margin-top: .4rem;
    }
    .sidebar a {
      display: flex; align-items: center; gap: 9px;
      padding: .62rem .8rem; border-radius: 9px;
      color: #ffffffb3; text-decoration: none;
      font-size: .875rem; font-weight: 400;
      transition: background .14s, color .14s;
    }
    .sidebar a:hover { background: var(--sidebar-hover); color: #fff; }
    .sidebar a.active { background: var(--sidebar-act); color: #fff; font-weight: 500; }
    .sidebar a.active .si { color: var(--accent); }
    .si { width: 17px; height: 17px; flex-shrink: 0; }

    /* â”€â”€ MAIN â”€â”€ */
    .main {
      flex: 1; padding: 2.5rem 2.5rem 4rem; min-width: 0;
      animation: fadeUp .42s ease both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .pg-header { margin-bottom: 2rem; }
    .pg-header h1 {
      font-family: 'DM Serif Display', serif;
      font-size: 2rem; line-height: 1.2; font-weight: 400;
    }
    .pg-header h1 em { font-style: italic; color: var(--accent); }
    .pg-header p { margin-top: .3rem; color: var(--muted); font-size: .88rem; }

    /* â”€â”€ SECTION â”€â”€ */
    section { margin-bottom: 2.5rem; }
    .sec-head {
      font-family: 'DM Serif Display', serif; font-size: 1.22rem; font-weight: 400;
      margin-bottom: 1rem;
      display: flex; align-items: center; justify-content: space-between;
    }
    .sec-head a {
      font-family: 'DM Sans', sans-serif; font-size: .8rem;
      color: var(--accent2); text-decoration: none; font-weight: 500;
    }
    .sec-head a:hover { text-decoration: underline; }

    /* â”€â”€ NEXT APPOINTMENT â€” FULL WIDTH CARD â”€â”€ */
    .next-appt-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      overflow: hidden;
      width: 100%;
    }

    /* Coloured top band */
    .appt-card-band {
      background: var(--sidebar-bg);
      padding: 1.4rem 2rem;
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;
    }
    .appt-band-left { display: flex; align-items: center; gap: 1.25rem; }
    .appt-date-badge {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding: .8rem 1.1rem; text-align: center;
      min-width: 62px; flex-shrink: 0; color: #fff;
    }
    .appt-date-badge .day {
      font-family: 'DM Serif Display', serif;
      font-size: 2rem; line-height: 1;
    }
    .appt-date-badge .mon {
      font-size: .67rem; text-transform: uppercase;
      letter-spacing: .1em; color: var(--accent); margin-top: 3px;
    }
    .appt-band-title { color: #fff; }
    .appt-band-title h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.25rem; font-weight: 400;
    }
    .appt-band-title p { font-size: .82rem; color: #ffffff80; margin-top: 2px; }

    .status-badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 5px 14px; border-radius: 20px;
      font-size: .78rem; font-weight: 600; text-transform: capitalize;
      flex-shrink: 0;
    }
    .s-requested  { background: #fdf3e0; color: #8a5e00; }
    .s-confirmed  { background: #e3f1f7; color: #1a6180; }
    .s-checked_in { background: #e8f5ec; color: #2e7d4f; }
    .s-completed  { background: #f0f0f0; color: #555; }
    .s-cancelled  { background: #fde8e8; color: #8a0000; }
    .sbadge-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }

    /* Card body */
    .appt-card-body {
      padding: 1.75rem 2rem;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 2rem;
      align-items: start;
    }

    /* Doctor column */
    .doc-col { display: flex; align-items: center; gap: 1rem; min-width: 200px; }
    .doc-avatar {
      width: 56px; height: 56px; border-radius: 50%; flex-shrink: 0;
      background: linear-gradient(135deg, var(--accent2), #4a7f9b);
      display: flex; align-items: center; justify-content: center;
      font-family: 'DM Serif Display', serif; font-size: 1.3rem; color: #fff;
    }
    .doc-name { font-size: 1rem; font-weight: 600; }
    .doc-spec { font-size: .8rem; color: var(--muted); margin-top: 2px; }
    .doc-bio  { font-size: .78rem; color: var(--muted); margin-top: 4px; font-style: italic; }

    /* Details grid */
    .appt-details {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1.1rem;
      border-left: 1px solid var(--border);
      border-right: 1px solid var(--border);
      padding: 0 2rem;
    }
    .detail-item label {
      display: block; font-size: .69rem; text-transform: uppercase;
      letter-spacing: .09em; color: var(--muted); margin-bottom: 3px;
    }
    .detail-item span {
      font-size: .9rem; font-weight: 500; color: var(--text);
      display: flex; align-items: center; gap: 5px;
    }
    .detail-item span svg { width: 14px; height: 14px; fill: var(--accent2); flex-shrink: 0; }

    /* Actions column */
    .appt-actions-col { display: flex; flex-direction: column; gap: .5rem; min-width: 130px; }
    .btn {
      padding: 8px 18px; border-radius: 8px; font-size: .82rem;
      font-weight: 500; cursor: pointer; border: none; font-family: inherit;
      transition: all .14s; text-align: center;
    }
    .btn-dark { background: var(--sidebar-bg); color: #fff; }
    .btn-dark:hover { background: #2e2e4a; }
    .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-ghost:hover { background: var(--bg); }
    .btn-red { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
    .btn-red:hover { background: #fdf0f0; }

    /* â”€â”€ INSIGHT CARDS â”€â”€ */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 1rem;
      margin-top: 1.25rem;
    }
    .insight-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1.3rem 1.4rem;
      box-shadow: var(--shadow);
      display: flex; flex-direction: column; gap: .4rem;
      min-height: 110px;
      position: relative; overflow: hidden;
      transition: transform .18s, box-shadow .18s;
    }
    .insight-card:hover { transform: translateY(-2px); box-shadow: 0 8px 26px rgba(0,0,0,.1); }
    .insight-lbl {
      font-size: .71rem; color: var(--muted); font-weight: 600;
      text-transform: uppercase; letter-spacing: .08em;
    }
    .insight-val {
      font-family: 'DM Serif Display', serif; font-size: 1.9rem;
      color: var(--text); line-height: 1;
    }
    .insight-val.empty { color: var(--border); font-size: 1.5rem; }
    .insight-sub { font-size: .76rem; color: var(--muted); }
    /* Subtle corner accent */
    .insight-card::after {
      content: ''; position: absolute;
      bottom: -18px; right: -18px;
      width: 60px; height: 60px; border-radius: 50%;
      background: var(--bg);
    }

    /* â”€â”€ EMPTY STATE â”€â”€ */
    .empty-state {
      background: var(--surface); border: 1px dashed var(--border);
      border-radius: var(--radius); padding: 2.5rem;
      text-align: center; color: var(--muted);
    }
    .empty-state svg { width: 40px; height: 40px; fill: var(--border); display: block; margin: 0 auto .75rem; }
    .empty-state p { font-size: .88rem; }
    .empty-state a {
      display: inline-block; margin-top: .85rem;
      font-size: .83rem; color: var(--accent2); text-decoration: none; font-weight: 500;
    }
    .empty-state a:hover { text-decoration: underline; }

    /* â”€â”€ PLACEHOLDER SECTIONS â”€â”€ */
    .placeholder-section {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 2rem 1.8rem;
      box-shadow: var(--shadow); color: var(--muted); font-size: .88rem;
    }
    .coming-soon {
      display: flex; align-items: center; gap: 7px;
      font-size: .8rem; font-weight: 500; color: var(--accent2);
    }
    .coming-soon svg { width: 15px; height: 15px; fill: var(--accent2); flex-shrink: 0; }
    .placeholder-section p { margin-top: .55rem; font-size: .8rem; }
    .placeholder-section code {
      background: var(--bg); padding: 1px 6px; border-radius: 5px;
      font-size: .78rem; color: var(--text);
    }

    @media (max-width: 900px) {
      .appt-card-body { grid-template-columns: 1fr; gap: 1.5rem; }
      .appt-details { border: none; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 1.25rem 0; }
      .appt-actions-col { flex-direction: row; flex-wrap: wrap; }
    }

    @media (max-width: 760px) {
      .sidebar { display: none; }
      .main { padding: 1.5rem 1.25rem; }
      .topnav { padding: 0 1rem; }
      .pg-header h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

<!-- TOP NAV -->
<nav class="topnav">
  <a class="brand" href="{% url 'patient_dashboard' %}">
    <div class="brand-icon">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14h-2v-4H7v-2h4V6h2v4h4v2h-4v4z"/></svg>
    </div>
    <span class="brand-name">MediCare</span>
  </a>
  <div class="nav-right">
    <div class="nav-avatar">{{ request.user.first_name|first|upper }}{{ request.user.last_name|first|upper }}</div>
    <a class="logout" href="{% url 'logout' %}">Sign out</a>
  </div>
</nav>

<div class="shell">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <span class="sec-label">Navigation</span>

    <a href="#overview" class="active">
      <svg class="si" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
      </svg>
      Overview
    </a>
    <a href="#upcoming">
      <svg class="si" viewBox="0 0 24 24" fill="currentColor">
        <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/>
      </svg>
      Upcoming Appointments
    </a>
    <a href="#history">
      <svg class="si" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
      </svg>
      History
    </a>
    <a href="#records">
      <svg class="si" viewBox="0 0 24 24" fill="currentColor">
        <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
      </svg>
      Medical Records
    </a>

    <span class="sec-label" style="margin-top:auto">Account</span>
    <a href="#">
      <svg class="si" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
      </svg>
      Help & Support
    </a>
  </nav>

  <!-- MAIN -->
  <main class="main">

    <div class="pg-header">
      <h1>Good morning, <em>{{ request.user.first_name }}</em> ðŸ‘‹</h1>
      <p>Here's a summary of your health activity.</p>
    </div>

    <!-- OVERVIEW â€” NEXT APPOINTMENT + INSIGHTS -->
    <section id="overview">
      <div class="sec-head">
        Next Appointment
        <a href="#upcoming">View all â†’</a>
      </div>

      {% if next_appointment %}

      <!-- â”€â”€ FULL WIDTH APPOINTMENT CARD â”€â”€ -->
      <div class="next-appt-card">

        <!-- Dark header band -->
        <div class="appt-card-band">
          <div class="appt-band-left">
            <div class="appt-date-badge">
              <div class="day">{{ next_appointment.created_at|slice:"8:10" }}</div>
              <div class="mon">
                {% with m=next_appointment.created_at|slice:"5:7" %}
                  {% if m == "01" %}Jan{% elif m == "02" %}Feb{% elif m == "03" %}Mar
                  {% elif m == "04" %}Apr{% elif m == "05" %}May{% elif m == "06" %}Jun
                  {% elif m == "07" %}Jul{% elif m == "08" %}Aug{% elif m == "09" %}Sep
                  {% elif m == "10" %}Oct{% elif m == "11" %}Nov{% else %}Dec{% endif %}
                {% endwith %}
              </div>
            </div>
            <div class="appt-band-title">
              <h3>Dr. {{ next_appointment.doctor.user.first_name }} {{ next_appointment.doctor.user.last_name }}</h3>
              <p>{{ next_appointment.doctor.specialization }} &nbsp;Â·&nbsp; {{ next_appointment.created_at|slice:":16" }}</p>
            </div>
          </div>
          <span class="status-badge s-{{ next_appointment.status }}">
            <span class="sbadge-dot"></span>
            {{ next_appointment.status|title }}
          </span>
        </div>

        <!-- Card body: doctor / details / actions -->
        <div class="appt-card-body">

          <!-- Doctor column -->
          <div class="doc-col">
            <div class="doc-avatar">{{ next_appointment.doctor.user.first_name|first|upper }}</div>
            <div>
              <div class="doc-name">Dr. {{ next_appointment.doctor.user.first_name }} {{ next_appointment.doctor.user.last_name }}</div>
              <div class="doc-spec">{{ next_appointment.doctor.specialization }}</div>
              <div class="doc-bio">{{ next_appointment.doctor.bio }}</div>
            </div>
          </div>

          <!-- Details grid -->
          <div class="appt-details">
            <div class="detail-item">
              <label>Requested On</label>
              <span>
                <svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg>
                {{ next_appointment.created_at|slice:":10" }}
              </span>
            </div>
            <div class="detail-item">
              <label>Time</label>
              <span>
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5z"/></svg>
                {{ next_appointment.created_at|slice:"11:16" }}
              </span>
            </div>
            <div class="detail-item">
              <label>Session Duration</label>
              <span>
                <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/></svg>
                {{ next_appointment.doctor.session_duration }} minutes
              </span>
            </div>
            <div class="detail-item">
              <label>Status</label>
              <span>{{ next_appointment.status|title }}</span>
            </div>
            <div class="detail-item">
              <label>Doctor Email</label>
              <span>{{ next_appointment.doctor.user.email }}</span>
            </div>
            {% if next_appointment.check_in_at %}
            <div class="detail-item">
              <label>Checked In At</label>
              <span>
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
                {{ next_appointment.check_in_at|slice:":16" }}
              </span>
            </div>
            {% endif %}
          </div>

          <!-- Actions column -->
          <div class="appt-actions-col">
            <button class="btn btn-dark">View Details</button>
            <button class="btn btn-ghost">Reschedule</button>
            {% if next_appointment.status != "cancelled" and next_appointment.status != "completed" %}
            <button class="btn btn-red">Cancel</button>
            {% endif %}
          </div>

        </div>
      </div>

      {% else %}
      <div class="empty-state">
        <svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg>
        <p>You have no upcoming appointments.</p>
        <a href="#">Book an appointment â†’</a>
      </div>
      {% endif %}

  </main>
</div>

<script>
  const sections = document.querySelectorAll('section[id]');
  const links    = document.querySelectorAll('.sidebar a[href^="#"]');
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        links.forEach(l => l.classList.remove('active'));
        const a = document.querySelector(`.sidebar a[href="#${e.target.id}"]`);
        if (a) a.classList.add('active');
      }
    });
  }, { rootMargin: '-25% 0px -65% 0px' });
  sections.forEach(s => obs.observe(s));
</script>
</body>
</html>